<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="/brand_assets/logos/concept-1-el-sello-white-bg.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>Formulario Plan Esencial — Carta de Invitación a México</title>
  <meta name="description" content="Completa tu solicitud de Carta de Invitación a México. Plan Esencial $5 USD. Proceso 100% en línea, seguro e inmediato.">
  <meta name="robots" content="noindex, nofollow">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,500;0,600;0,700;1,500;1,600&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: {
              50:  '#EDF0F8', 100: '#C5D0EC', 200: '#9BAFD9',
              300: '#7090C6', 400: '#4A6FA5', 500: '#3A5A8E',
              600: '#2D5499', 700: '#1B3566', 800: '#132648', 900: '#0C1830',
            },
            gold: {
              100: '#F5EEC8', 200: '#E8D080', 300: '#D9BC5C',
              400: '#C9A84C', 500: '#B08930', 600: '#8B6A1E',
            }
          },
          fontFamily: {
            display: ['"Cormorant Garamond"', 'Georgia', 'serif'],
            sans: ['"DM Sans"', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --c-navy:  #1B3566;
      --c-navy2: #132648;
      --c-navy3: #0C1830;
      --c-mid:   #4A6FA5;
      --c-gold:  #C9A84C;
      --c-gold2: #D9BC5C;
      --c-cream: #FAF8F4;
    }

    *, *::before, *::after { box-sizing: border-box; }

    html { overflow-x: hidden; }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      color: var(--c-navy);
      background: var(--c-cream);
      min-height: 100vh;
    }

    /* ── Form inputs ── */
    .form-input {
      width: 100%;
      border: 1.5px solid rgba(27,53,102,0.16);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 16px;
      font-family: 'DM Sans', system-ui, sans-serif;
      color: var(--c-navy);
      background: #fff;
      transition: border-color 0.18s ease, box-shadow 0.18s ease;
      appearance: none;
      -webkit-appearance: none;
    }
    .form-input:focus {
      outline: none;
      border-color: var(--c-gold);
      box-shadow: 0 0 0 3px rgba(201,168,76,0.14);
    }
    .form-input.error {
      border-color: #E53E3E;
      box-shadow: 0 0 0 3px rgba(229,62,62,0.1);
    }
    .form-input::placeholder { color: rgba(27,53,102,0.32); }
    select.form-input {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath d='M4 6l4 4 4-4' stroke='%234A6FA5' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
      cursor: pointer;
    }
    textarea.form-input { resize: vertical; min-height: 96px; line-height: 1.6; }

    /* ── Labels ── */
    .form-label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--c-navy);
      margin-bottom: 6px;
      letter-spacing: 0.01em;
    }
    .form-label .req { color: var(--c-gold); margin-left: 2px; }

    /* ── Hints & errors ── */
    .form-hint {
      font-size: 0.75rem;
      color: #6B7280;
      margin-top: 5px;
      line-height: 1.5;
    }
    .form-hint.warn {
      color: #7B5A24;
      background: rgba(201,168,76,0.1);
      border-left: 2.5px solid var(--c-gold);
      padding: 6px 10px;
      border-radius: 0 6px 6px 0;
      margin-top: 8px;
    }
    .form-error {
      font-size: 0.75rem;
      color: #C53030;
      margin-top: 5px;
      display: none;
      font-weight: 500;
    }
    .form-error.show { display: block; }

    /* ── Step transitions ── */
    .form-step { display: none; }
    .form-step.active {
      display: block;
      animation: stepIn 0.42s cubic-bezier(0.22,1,0.36,1) both;
    }
    @keyframes stepIn {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ── Sidebar ── */
    .step-pill {
      display: flex;
      align-items: flex-start;
      gap: 13px;
      padding: 9px 0;
      position: relative;
    }
    .step-pill::after {
      content: '';
      position: absolute;
      left: 14px;
      top: 38px;
      bottom: -9px;
      width: 1.5px;
      background: rgba(255,255,255,0.08);
    }
    .step-pill:last-child::after { display: none; }
    .step-pill.pill-nav { cursor: pointer; border-radius: 8px; margin: 0 -8px; padding-left: 8px; padding-right: 8px; transition: background 0.15s ease; }
    .step-pill.pill-nav:hover { background: rgba(255,255,255,0.07); }
    .pill-dot {
      width: 28px; height: 28px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      font-size: 0.7rem; font-weight: 700;
      transition: background 0.25s ease, color 0.25s ease;
    }
    .pill-dot.pending { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.3); }
    .pill-dot.active  { background: var(--c-gold); color: var(--c-navy); }
    .pill-dot.done    { background: rgba(201,168,76,0.2); color: var(--c-gold); }
    .pill-label { font-size: 0.8rem; padding-top: 4px; }
    .pill-label.pending-txt { color: rgba(255,255,255,0.3); }
    .pill-label.active-txt  { color: #fff; font-weight: 600; }
    .pill-label.done-txt    { color: rgba(255,255,255,0.5); }
    .pill-sub { font-size: 0.68rem; color: rgba(255,255,255,0.22); margin-top: 1px; }

    /* ── Mobile progress bar ── */
    .mob-progress-track {
      height: 3px;
      background: rgba(27,53,102,0.1);
      border-radius: 99px;
      overflow: hidden;
    }
    .mob-progress-fill {
      height: 100%;
      background: var(--c-gold);
      border-radius: 99px;
      transition: width 0.4s cubic-bezier(0.22,1,0.36,1);
    }

    /* ── Radio/checkbox cards ── */
    .radio-card {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      border: 1.5px solid rgba(27,53,102,0.14);
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.18s ease, background 0.18s ease;
      min-height: 44px;
      background: #fff;
      user-select: none;
    }
    .radio-card:hover { border-color: rgba(201,168,76,0.45); background: rgba(201,168,76,0.03); }
    .radio-card.selected { border-color: var(--c-gold); background: rgba(201,168,76,0.07); }
    .radio-card input[type="radio"],
    .radio-card input[type="checkbox"] {
      accent-color: var(--c-gold);
      width: 16px; height: 16px;
      cursor: pointer; flex-shrink: 0;
    }
    .radio-card span { font-size: 0.875rem; color: var(--c-navy); font-weight: 500; }

    /* ── Transport-type radio card (icon + label stacked) ── */
    .transport-type-card {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 6px;
      padding: 14px 8px;
      border: 1.5px solid rgba(27,53,102,0.14);
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.18s ease, background 0.18s ease;
      min-height: 80px;
      background: #fff;
      text-align: center;
      user-select: none;
    }
    .transport-type-card:hover { border-color: rgba(201,168,76,0.45); background: rgba(201,168,76,0.03); }
    .transport-type-card.selected { border-color: var(--c-gold); background: rgba(201,168,76,0.07); }
    .transport-type-card input { display: none; }
    .transport-type-card .tt-icon { font-size: 1.4rem; }
    .transport-type-card .tt-text { font-size: 0.8rem; font-weight: 600; color: var(--c-navy); }

    /* ── Expense radios ── */
    .expense-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 13px 0;
      border-bottom: 1px solid rgba(27,53,102,0.07);
      flex-wrap: wrap;
    }
    .expense-row:last-child { border-bottom: none; }
    .expense-row.error { background: rgba(197,48,48,0.04); border-radius: 6px; margin: 0 -4px; padding-left: 4px; padding-right: 4px; }
    .expense-row.error .expense-concept { color: #C53030; }
    .expense-concept { font-size: 0.875rem; font-weight: 500; color: var(--c-navy); flex-shrink: 0; }
    .expense-options { display: flex; gap: 6px; flex-wrap: wrap; }
    .exp-radio {
      display: flex; align-items: center; gap: 5px;
      padding: 6px 11px;
      border: 1.5px solid rgba(27,53,102,0.12);
      border-radius: 7px;
      background: #fff;
      cursor: pointer;
      font-size: 0.78rem; font-weight: 500; color: var(--c-mid);
      transition: border-color 0.15s ease, background 0.15s ease, color 0.15s ease;
      min-height: 36px;
      white-space: nowrap;
      user-select: none;
    }
    .exp-radio input[type="radio"] { display: none; }
    .exp-radio.selected-exp {
      border-color: var(--c-gold);
      background: rgba(201,168,76,0.1);
      color: var(--c-navy);
      font-weight: 600;
    }
    .exp-radio:hover { border-color: rgba(201,168,76,0.4); }

    /* ── Conditional fields ── */
    .cond-fields {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.38s ease, opacity 0.3s ease, margin-top 0.25s ease;
    }
    .cond-fields.open {
      max-height: 360px;
      opacity: 1;
      margin-top: 16px;
    }

    /* ── Buttons ── */
    .btn-gold {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      background: var(--c-gold); color: var(--c-navy);
      font-weight: 700; border-radius: 12px;
      min-height: 52px; padding: 0 2rem; font-size: 1rem;
      border: none; cursor: pointer;
      font-family: 'DM Sans', system-ui, sans-serif;
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.15s ease;
    }
    .btn-gold:hover { background: var(--c-gold2); box-shadow: 0 6px 28px rgba(201,168,76,0.42); transform: translateY(-2px); }
    .btn-gold:active { transform: translateY(0); }
    .btn-gold:focus-visible { outline: 3px solid var(--c-gold2); outline-offset: 3px; }

    .btn-navy {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      background: var(--c-navy); color: #fff;
      font-weight: 700; border-radius: 12px;
      min-height: 52px; padding: 0 2rem; font-size: 1rem;
      border: none; cursor: pointer;
      font-family: 'DM Sans', system-ui, sans-serif;
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.15s ease;
    }
    .btn-navy:hover { background: var(--c-navy2); box-shadow: 0 6px 24px rgba(27,53,102,0.35); transform: translateY(-2px); }
    .btn-navy:active { transform: translateY(0); }
    .btn-navy:focus-visible { outline: 3px solid var(--c-gold); outline-offset: 3px; }

    .btn-back {
      display: inline-flex; align-items: center; gap: 6px;
      background: transparent; color: var(--c-mid);
      font-weight: 500; border-radius: 10px;
      min-height: 52px; padding: 0 1.25rem; font-size: 0.9rem;
      border: 1.5px solid rgba(74,111,165,0.2);
      cursor: pointer;
      font-family: 'DM Sans', system-ui, sans-serif;
      transition: color 0.18s ease, background 0.18s ease;
    }
    .btn-back:hover { color: var(--c-navy); background: rgba(27,53,102,0.04); }
    .btn-back:focus-visible { outline: 3px solid var(--c-gold); outline-offset: 2px; }

    /* ── Gold rule ── */
    .gold-rule {
      height: 1px;
      background: linear-gradient(to right, transparent, var(--c-gold), transparent);
      opacity: 0.28;
    }

    /* ── Section label ── */
    .section-label {
      font-size: 0.6875rem;
      font-weight: 700;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      color: var(--c-gold);
      display: block;
    }

    /* ── Step icon box ── */
    .step-icon {
      width: 46px; height: 46px; border-radius: 13px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(201,168,76,0.1);
      border: 1px solid rgba(201,168,76,0.22);
      flex-shrink: 0;
    }

    /* ── Grain texture ── */
    .grain { position: relative; }
    .grain::after {
      content: '';
      position: absolute; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
      opacity: 0.038; pointer-events: none; z-index: 1; mix-blend-mode: overlay;
    }
    .grain > * { position: relative; z-index: 2; }

    /* ── Nav link ── */
    .nav-link {
      color: var(--c-mid); font-weight: 500; font-size: 0.875rem;
      transition: color 0.15s ease;
    }
    .nav-link:hover { color: var(--c-gold); }

    @media (max-width: 639px) {
      .expense-row { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>

<body>

<!-- ════════════════════ HEADER ════════════════════ -->
<header style="background:#fff;border-bottom:1px solid rgba(27,53,102,0.08);box-shadow:0 1px 12px rgba(27,53,102,0.05);"
        class="sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 flex items-center justify-between h-20">

    <a href="/" aria-label="Carta Invitación México — Inicio" class="flex-shrink-0">
      <img src="brand_assets/logos/concept-1-el-sello.svg"
           alt="Carta Invitación México" height="44" class="h-14 w-auto">
    </a>

    <div class="flex items-center gap-4">
      <span class="hidden sm:flex items-center gap-2 text-xs font-bold px-3 py-1.5 rounded-full"
            style="background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.25);color:var(--c-gold);">
        Plan Esencial · $5 USD
      </span>
    </div>

  </div>
</header>

<main>

<div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 md:py-12">

  <div class="md:grid md:gap-8 lg:gap-12" style="grid-template-columns:260px 1fr;">

    <!-- ════════════ LEFT SIDEBAR (desktop) ════════════ -->
    <aside class="hidden md:flex flex-col sticky top-24 self-start gap-6">

      <!-- Plan card -->
      <div class="rounded-2xl p-6 grain"
           style="background:linear-gradient(148deg,#1B3566 0%,#132648 100%);
                  border:1px solid rgba(201,168,76,0.18);
                  box-shadow:0 8px 44px rgba(27,53,102,0.3);">

        <p class="text-xs font-bold uppercase tracking-widest mb-0.5" style="color:rgba(201,168,76,0.55);letter-spacing:0.13em;">Plan Esencial</p>
        <p style="font-family:'Cormorant Garamond',Georgia,serif;font-size:2.75rem;font-weight:700;color:var(--c-gold);line-height:1.1;margin-bottom:1.25rem;">
          $5 <span style="font-size:1.25rem;color:rgba(255,255,255,0.3);">USD</span>
        </p>

        <div id="sidebar-steps">
          <div class="step-pill" id="sp-1">
            <div class="pill-dot" id="dot-1">1</div>
            <div><div class="pill-label" id="pl-1">El viajero</div><div class="pill-sub">Datos del extranjero</div></div>
          </div>
          <div class="step-pill" id="sp-2">
            <div class="pill-dot" id="dot-2">2</div>
            <div><div class="pill-label" id="pl-2">El anfitrión</div><div class="pill-sub">Quien firma en México</div></div>
          </div>
          <div class="step-pill" id="sp-3">
            <div class="pill-dot" id="dot-3">3</div>
            <div><div class="pill-label" id="pl-3">El viaje</div><div class="pill-sub">Alojamiento y actividades</div></div>
          </div>
          <div class="step-pill" id="sp-4">
            <div class="pill-dot" id="dot-4">4</div>
            <div><div class="pill-label" id="pl-4">Gastos</div><div class="pill-sub">¿Quién cubre qué?</div></div>
          </div>
          <div class="step-pill" id="sp-5">
            <div class="pill-dot" id="dot-5">5</div>
            <div><div class="pill-label" id="pl-5">Vuelos</div><div class="pill-sub">Ingreso y salida</div></div>
          </div>
          <div class="step-pill" id="sp-6">
            <div class="pill-dot" id="dot-6">6</div>
            <div><div class="pill-label" id="pl-6">Revisión</div><div class="pill-sub">Confirmar datos</div></div>
          </div>
        </div>
      </div>

      <!-- Trust notes -->
      <div class="space-y-3">
        <div class="flex items-start gap-2.5 text-xs" style="color:#6B7280;">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true" style="flex-shrink:0;margin-top:1px;">
            <rect x="1.5" y="5.5" width="11" height="7.5" rx="1.5" stroke="#C9A84C" stroke-width="1.1"/>
            <path d="M4 5.5V4a3 3 0 016 0v1.5" stroke="#C9A84C" stroke-width="1.1"/>
          </svg>
          Datos transmitidos de forma segura (HTTPS)
        </div>
        <div class="flex items-start gap-2.5 text-xs" style="color:#6B7280;">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true" style="flex-shrink:0;margin-top:1px;">
            <circle cx="7" cy="7" r="5.5" stroke="#C9A84C" stroke-width="1.1"/>
            <path d="M4.5 7l2 2 3.5-3.5" stroke="#C9A84C" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Recibes tu PDF en minutos tras el pago
        </div>
        <div class="flex items-start gap-2.5 text-xs" style="color:#6B7280;">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true" style="flex-shrink:0;margin-top:1px;">
            <path d="M7 1.5L8.5 5.5h4L9.5 8l1.5 4.5L7 10l-4 2.5 1.5-4.5-3-2.5h4z" stroke="#C9A84C" stroke-width="1.1"/>
          </svg>
          +2,400 cartas generadas · 4.9 estrellas
        </div>
      </div>

    </aside>

    <!-- ════════════ FORM PANEL ════════════ -->
    <div>

      <!-- Mobile: progress bar -->
      <div class="md:hidden mb-5">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs font-semibold" style="color:var(--c-gold);" id="mob-label">Paso 1 de 6 — El viajero</span>
          <span class="text-xs font-bold px-2.5 py-1 rounded-full" style="background:rgba(201,168,76,0.1);color:var(--c-gold);border:1px solid rgba(201,168,76,0.22);">$5 USD</span>
        </div>
        <div class="mob-progress-track">
          <div class="mob-progress-fill" id="mob-fill" style="width:20%;"></div>
        </div>
      </div>

      <!-- Form card -->
      <div class="bg-white rounded-2xl"
           style="overflow:clip;box-shadow:0 4px 36px rgba(27,53,102,0.08);border:1px solid rgba(27,53,102,0.07);">

        <form id="main-form" novalidate>

          <!-- ═══════════════════════════
               STEP 1 — EL VIAJERO
          ═══════════════════════════ -->
          <section id="step-1" class="form-step active p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <circle cx="11" cy="7" r="4" stroke="#C9A84C" stroke-width="1.5"/>
                  <path d="M3 19c0-4 3.6-7 8-7s8 3 8 7" stroke="#C9A84C" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 1 de 5</span>
                <h1 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">El viajero</h1>
                <p class="text-sm mt-1" style="color:#6B7280;">Datos de la persona que visitará México, tal como aparecen en su pasaporte.</p>
              </div>
            </div>

            <div class="space-y-5">

              <div>
                <label class="form-label" for="v-nombre">Nombre completo <span class="req">*</span></label>
                <input type="text" id="v-nombre" name="v_nombre" class="form-input"
                       placeholder="Tal como aparece en el pasaporte" required autocomplete="name">
                <p class="form-hint">Nombre(s) y apellidos completos.</p>
                <p class="form-error" id="err-v-nombre">Este campo es obligatorio.</p>
              </div>

              <div>
                <label class="form-label" for="v-nacimiento">Fecha de nacimiento <span class="req">*</span></label>
                <input type="date" id="v-nacimiento" name="v_nacimiento" class="form-input" required>
                <p class="form-error" id="err-v-nacimiento">Por favor ingresa la fecha de nacimiento.</p>
              </div>

              <div>
                <label class="form-label" for="v-nacionalidad">Nacionalidad <span class="req">*</span></label>
                <select id="v-nacionalidad" name="v_nacionalidad" class="form-input" required>
                  <option value="" disabled selected>La que aparece en tu pasaporte</option>
                  <optgroup label="América Latina y el Caribe">
                    <option>Antigua y Barbuda</option><option>Argentina</option><option>Bahamas</option>
                    <option>Barbados</option><option>Belice</option><option>Bolivia</option>
                    <option>Brasil</option><option>Chile</option><option>Colombia</option>
                    <option>Costa Rica</option><option>Cuba</option><option>Dominica</option>
                    <option>Ecuador</option><option>El Salvador</option><option>Granada</option>
                    <option>Guatemala</option><option>Guyana</option><option>Haití</option>
                    <option>Honduras</option><option>Jamaica</option><option>Nicaragua</option>
                    <option>Panamá</option><option>Paraguay</option><option>Perú</option>
                    <option>República Dominicana</option><option>San Cristóbal y Nieves</option>
                    <option>San Vicente y las Granadinas</option><option>Santa Lucía</option>
                    <option>Surinam</option><option>Trinidad y Tobago</option>
                    <option>Uruguay</option><option>Venezuela</option>
                  </optgroup>
                  <optgroup label="Norteamérica">
                    <option>Canadá</option><option>Estados Unidos</option>
                  </optgroup>
                  <optgroup label="Europa">
                    <option>Albania</option><option>Alemania</option><option>Andorra</option>
                    <option>Austria</option><option>Bélgica</option><option>Bielorrusia</option>
                    <option>Bosnia y Herzegovina</option><option>Bulgaria</option><option>Chipre</option>
                    <option>Ciudad del Vaticano</option><option>Croacia</option><option>Dinamarca</option>
                    <option>Eslovaquia</option><option>Eslovenia</option><option>España</option>
                    <option>Estonia</option><option>Finlandia</option><option>Francia</option>
                    <option>Grecia</option><option>Hungría</option><option>Irlanda</option>
                    <option>Islandia</option><option>Italia</option><option>Kosovo</option>
                    <option>Letonia</option><option>Liechtenstein</option><option>Lituania</option>
                    <option>Luxemburgo</option><option>Malta</option><option>Moldavia</option>
                    <option>Mónaco</option><option>Montenegro</option><option>Noruega</option>
                    <option>Países Bajos</option><option>Polonia</option><option>Portugal</option>
                    <option>Reino Unido</option><option>República Checa</option><option>Rumanía</option>
                    <option>Rusia</option><option>San Marino</option><option>Serbia</option>
                    <option>Suecia</option><option>Suiza</option><option>Ucrania</option>
                  </optgroup>
                  <optgroup label="África">
                    <option>Argelia</option><option>Angola</option><option>Benín</option>
                    <option>Botsuana</option><option>Burkina Faso</option><option>Burundi</option>
                    <option>Cabo Verde</option><option>Camerún</option><option>Chad</option>
                    <option>Comoras</option><option>Congo</option><option>Costa de Marfil</option>
                    <option>Egipto</option><option>Eritrea</option><option>Etiopía</option>
                    <option>Gabón</option><option>Gambia</option><option>Ghana</option>
                    <option>Guinea</option><option>Guinea Ecuatorial</option><option>Guinea-Bisáu</option>
                    <option>Kenia</option><option>Lesoto</option><option>Liberia</option>
                    <option>Libia</option><option>Madagascar</option><option>Malaui</option>
                    <option>Mali</option><option>Marruecos</option><option>Mauricio</option>
                    <option>Mauritania</option><option>Mozambique</option><option>Namibia</option>
                    <option>Níger</option><option>Nigeria</option><option>República Centroafricana</option>
                    <option>República Democrática del Congo</option><option>Ruanda</option>
                    <option>Santo Tomé y Príncipe</option><option>Senegal</option>
                    <option>Seychelles</option><option>Sierra Leona</option><option>Somalia</option>
                    <option>Sudáfrica</option><option>Sudán</option><option>Sudán del Sur</option>
                    <option>Suazilandia</option><option>Tanzania</option><option>Togo</option>
                    <option>Túnez</option><option>Uganda</option><option>Yibuti</option>
                    <option>Zambia</option><option>Zimbabue</option>
                  </optgroup>
                  <optgroup label="Asia y Medio Oriente">
                    <option>Afganistán</option><option>Arabia Saudita</option><option>Armenia</option>
                    <option>Azerbaiyán</option><option>Bangladés</option><option>Brunéi</option>
                    <option>Bután</option><option>Camboya</option><option>Catar</option>
                    <option>China</option><option>Corea del Norte</option><option>Corea del Sur</option>
                    <option>Emiratos Árabes Unidos</option><option>Filipinas</option><option>Georgia</option>
                    <option>India</option><option>Indonesia</option><option>Irak</option>
                    <option>Irán</option><option>Israel</option><option>Japón</option>
                    <option>Jordania</option><option>Kazajistán</option><option>Kirguistán</option>
                    <option>Kuwait</option><option>Laos</option><option>Líbano</option>
                    <option>Malasia</option><option>Maldivas</option><option>Mongolia</option>
                    <option>Myanmar</option><option>Nepal</option><option>Omán</option>
                    <option>Pakistán</option><option>Palestina</option><option>Singapur</option>
                    <option>Siria</option><option>Sri Lanka</option><option>Tailandia</option>
                    <option>Tayikistán</option><option>Timor Oriental</option><option>Turkmenistán</option>
                    <option>Turquía</option><option>Uzbekistán</option><option>Vietnam</option>
                    <option>Yemen</option>
                  </optgroup>
                  <optgroup label="Oceanía">
                    <option>Australia</option><option>Fiyi</option><option>Islas Marshall</option>
                    <option>Islas Salomón</option><option>Kiribati</option><option>Micronesia</option>
                    <option>Nauru</option><option>Nueva Zelanda</option><option>Palaos</option>
                    <option>Papúa Nueva Guinea</option><option>Samoa</option><option>Tonga</option>
                    <option>Tuvalu</option><option>Vanuatu</option>
                  </optgroup>
                </select>
                <p class="form-error" id="err-v-nacionalidad">Por favor selecciona una nacionalidad.</p>
              </div>

              <div>
                <label class="form-label" for="v-pasaporte">Número de pasaporte <span class="req">*</span></label>
                <input type="text" id="v-pasaporte" name="v_pasaporte" class="form-input"
                       placeholder="Ej. AB123456" required autocomplete="off">
                <p class="form-hint warn">⚠ Verifica que el pasaporte tenga al menos <strong>6 meses de vigencia</strong> a partir de la fecha de entrada a México.</p>
                <p class="form-error" id="err-v-pasaporte">Por favor ingresa el número de pasaporte.</p>
              </div>

              <div>
                <label class="form-label" for="v-residencia">País de residencia <span class="req">*</span></label>
                <select id="v-residencia" name="v_residencia" class="form-input" required>
                  <option value="" disabled selected>País donde resides actualmente</option>
                  <optgroup label="América Latina y el Caribe">
                    <option>Antigua y Barbuda</option><option>Argentina</option><option>Bahamas</option>
                    <option>Barbados</option><option>Belice</option><option>Bolivia</option>
                    <option>Brasil</option><option>Chile</option><option>Colombia</option>
                    <option>Costa Rica</option><option>Cuba</option><option>Dominica</option>
                    <option>Ecuador</option><option>El Salvador</option><option>Granada</option>
                    <option>Guatemala</option><option>Guyana</option><option>Haití</option>
                    <option>Honduras</option><option>Jamaica</option><option>Nicaragua</option>
                    <option>Panamá</option><option>Paraguay</option><option>Perú</option>
                    <option>República Dominicana</option><option>San Cristóbal y Nieves</option>
                    <option>San Vicente y las Granadinas</option><option>Santa Lucía</option>
                    <option>Surinam</option><option>Trinidad y Tobago</option>
                    <option>Uruguay</option><option>Venezuela</option>
                  </optgroup>
                  <optgroup label="Norteamérica">
                    <option>Canadá</option><option>Estados Unidos</option>
                  </optgroup>
                  <optgroup label="Europa">
                    <option>Albania</option><option>Alemania</option><option>Andorra</option>
                    <option>Austria</option><option>Bélgica</option><option>Bielorrusia</option>
                    <option>Bosnia y Herzegovina</option><option>Bulgaria</option><option>Chipre</option>
                    <option>Ciudad del Vaticano</option><option>Croacia</option><option>Dinamarca</option>
                    <option>Eslovaquia</option><option>Eslovenia</option><option>España</option>
                    <option>Estonia</option><option>Finlandia</option><option>Francia</option>
                    <option>Grecia</option><option>Hungría</option><option>Irlanda</option>
                    <option>Islandia</option><option>Italia</option><option>Kosovo</option>
                    <option>Letonia</option><option>Liechtenstein</option><option>Lituania</option>
                    <option>Luxemburgo</option><option>Malta</option><option>Moldavia</option>
                    <option>Mónaco</option><option>Montenegro</option><option>Noruega</option>
                    <option>Países Bajos</option><option>Polonia</option><option>Portugal</option>
                    <option>Reino Unido</option><option>República Checa</option><option>Rumanía</option>
                    <option>Rusia</option><option>San Marino</option><option>Serbia</option>
                    <option>Suecia</option><option>Suiza</option><option>Ucrania</option>
                  </optgroup>
                  <optgroup label="África">
                    <option>Argelia</option><option>Angola</option><option>Benín</option>
                    <option>Botsuana</option><option>Burkina Faso</option><option>Burundi</option>
                    <option>Cabo Verde</option><option>Camerún</option><option>Chad</option>
                    <option>Comoras</option><option>Congo</option><option>Costa de Marfil</option>
                    <option>Egipto</option><option>Eritrea</option><option>Etiopía</option>
                    <option>Gabón</option><option>Gambia</option><option>Ghana</option>
                    <option>Guinea</option><option>Guinea Ecuatorial</option><option>Guinea-Bisáu</option>
                    <option>Kenia</option><option>Lesoto</option><option>Liberia</option>
                    <option>Libia</option><option>Madagascar</option><option>Malaui</option>
                    <option>Mali</option><option>Marruecos</option><option>Mauricio</option>
                    <option>Mauritania</option><option>Mozambique</option><option>Namibia</option>
                    <option>Níger</option><option>Nigeria</option><option>República Centroafricana</option>
                    <option>República Democrática del Congo</option><option>Ruanda</option>
                    <option>Santo Tomé y Príncipe</option><option>Senegal</option>
                    <option>Seychelles</option><option>Sierra Leona</option><option>Somalia</option>
                    <option>Sudáfrica</option><option>Sudán</option><option>Sudán del Sur</option>
                    <option>Suazilandia</option><option>Tanzania</option><option>Togo</option>
                    <option>Túnez</option><option>Uganda</option><option>Yibuti</option>
                    <option>Zambia</option><option>Zimbabue</option>
                  </optgroup>
                  <optgroup label="Asia y Medio Oriente">
                    <option>Afganistán</option><option>Arabia Saudita</option><option>Armenia</option>
                    <option>Azerbaiyán</option><option>Bangladés</option><option>Brunéi</option>
                    <option>Bután</option><option>Camboya</option><option>Catar</option>
                    <option>China</option><option>Corea del Norte</option><option>Corea del Sur</option>
                    <option>Emiratos Árabes Unidos</option><option>Filipinas</option><option>Georgia</option>
                    <option>India</option><option>Indonesia</option><option>Irak</option>
                    <option>Irán</option><option>Israel</option><option>Japón</option>
                    <option>Jordania</option><option>Kazajistán</option><option>Kirguistán</option>
                    <option>Kuwait</option><option>Laos</option><option>Líbano</option>
                    <option>Malasia</option><option>Maldivas</option><option>Mongolia</option>
                    <option>Myanmar</option><option>Nepal</option><option>Omán</option>
                    <option>Pakistán</option><option>Palestina</option><option>Singapur</option>
                    <option>Siria</option><option>Sri Lanka</option><option>Tailandia</option>
                    <option>Tayikistán</option><option>Timor Oriental</option><option>Turkmenistán</option>
                    <option>Turquía</option><option>Uzbekistán</option><option>Vietnam</option>
                    <option>Yemen</option>
                  </optgroup>
                  <optgroup label="Oceanía">
                    <option>Australia</option><option>Fiyi</option><option>Islas Marshall</option>
                    <option>Islas Salomón</option><option>Kiribati</option><option>Micronesia</option>
                    <option>Nauru</option><option>Nueva Zelanda</option><option>Palaos</option>
                    <option>Papúa Nueva Guinea</option><option>Samoa</option><option>Tonga</option>
                    <option>Tuvalu</option><option>Vanuatu</option>
                  </optgroup>
                </select>
                <p class="form-hint">Puede ser diferente a tu nacionalidad.</p>
                <p class="form-error" id="err-v-residencia">Por favor ingresa tu país de residencia.</p>
              </div>

              <div>
                <label class="form-label">Domicilio completo <span class="req">*</span></label>
                <div class="space-y-3">
                  <input type="text" id="v-calle" name="v_calle" class="form-input"
                         placeholder="Calle, número, e interior (si aplica)" required>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="v-ciudad" name="v_ciudad" class="form-input" placeholder="Ciudad" required>
                    <input type="text" id="v-provincia" name="v_provincia" class="form-input" placeholder="Provincia / Estado / Región" required>
                  </div>
                  <input type="text" id="v-cp" name="v_cp" class="form-input" placeholder="Código Postal" required>
                </div>
                <p class="form-error" id="err-v-domicilio">Por favor completa los campos de domicilio.</p>
              </div>

              <div>
                <label class="form-label" for="v-ocupacion">Actividad profesional u ocupación <span class="req">*</span></label>
                <input type="text" id="v-ocupacion" name="v_ocupacion" class="form-input"
                       placeholder="Ej. Ingeniero, Estudiante, Comerciante…" required>
                <p class="form-hint">En tu país de residencia.</p>
                <p class="form-error" id="err-v-ocupacion">Por favor ingresa tu ocupación.</p>
              </div>

              <div>
                <label class="form-label" for="v-email">Correo electrónico <span class="req">*</span></label>
                <input type="email" id="v-email" name="v_email" class="form-input"
                       placeholder="nombre@correo.com" required autocomplete="email"
                       oninput="this.value=this.value.replace(/\s/g,'')"
                       onblur="emailReq('v-email','err-v-email')">
                <p class="form-hint">Te enviaremos tu carta en PDF a este correo.</p>
                <p class="form-error" id="err-v-email">Por favor ingresa un correo electrónico válido (ej. nombre@correo.com).</p>
              </div>

            </div>

            <div class="flex justify-end mt-8">
              <button type="button" class="btn-gold" onclick="goNext(1)">
                Continuar
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </section>


          <!-- ═══════════════════════════
               STEP 2 — EL ANFITRIÓN
          ═══════════════════════════ -->
          <section id="step-2" class="form-step p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <path d="M3 9l8-5.5L19 9v9a1 1 0 01-1 1H4a1 1 0 01-1-1V9z" stroke="#C9A84C" stroke-width="1.5" stroke-linejoin="round"/>
                  <path d="M9 19v-6h4v6" stroke="#C9A84C" stroke-width="1.5" stroke-linejoin="round"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 2 de 5</span>
                <h2 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">El anfitrión</h2>
                <p class="text-sm mt-1" style="color:#6B7280;">Datos del mexicano o residente en México que firmará la carta.</p>
              </div>
            </div>

            <div class="space-y-5">

              <div>
                <label class="form-label" for="a-nombre">Nombre completo <span class="req">*</span></label>
                <input type="text" id="a-nombre" name="a_nombre" class="form-input"
                       placeholder="Tal como aparece en tu identificación oficial" required>
                <p class="form-error" id="err-a-nombre">Este campo es obligatorio.</p>
              </div>

              <div>
                <label class="form-label" for="a-nacimiento">Fecha de nacimiento <span class="req">*</span></label>
                <input type="date" id="a-nacimiento" name="a_nacimiento" class="form-input" required>
                <p class="form-error" id="err-a-nacimiento">Por favor ingresa la fecha de nacimiento.</p>
              </div>

              <div>
                <label class="form-label" for="a-id-tipo">Tipo de identificación oficial <span class="req">*</span></label>
                <select id="a-id-tipo" name="a_id_tipo" class="form-input" required>
                  <option value="" disabled selected>Selecciona el tipo</option>
                  <option value="pasaporte">Pasaporte mexicano</option>
                  <option value="ine">INE / IFE</option>
                  <option value="residente">Tarjeta de residente</option>
                </select>
                <p class="form-hint warn">⚠ Se deberá anexar copia de esta identificación a la carta de invitación.</p>
                <p class="form-error" id="err-a-id-tipo">Por favor selecciona el tipo de identificación.</p>
              </div>

              <div>
                <label class="form-label" for="a-id-num">Número de identificación <span class="req">*</span></label>
                <input type="text" id="a-id-num" name="a_id_num" class="form-input"
                       placeholder="Número que aparece en tu identificación" required autocomplete="off">
                <p class="form-error" id="err-a-id-num">Por favor ingresa el número de identificación.</p>
              </div>

              <div>
                <label class="form-label">Domicilio en México <span class="req">*</span></label>
                <div class="space-y-3">
                  <input type="text" id="a-calle" name="a_calle" class="form-input" placeholder="Calle y número" required>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="a-colonia" name="a_colonia" class="form-input" placeholder="Colonia" required>
                    <input type="text" id="a-delegacion" name="a_delegacion" class="form-input" placeholder="Delegación o Municipio" required>
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="a-ciudad" name="a_ciudad" class="form-input" placeholder="Ciudad" required>
                    <select id="a-estado" name="a_estado" class="form-input" required>
                      <option value="" disabled selected>Estado</option>
                      <option>Aguascalientes</option>
                      <option>Baja California</option>
                      <option>Baja California Sur</option>
                      <option>Campeche</option>
                      <option>Chiapas</option>
                      <option>Chihuahua</option>
                      <option>Ciudad de México</option>
                      <option>Coahuila</option>
                      <option>Colima</option>
                      <option>Durango</option>
                      <option>Guanajuato</option>
                      <option>Guerrero</option>
                      <option>Hidalgo</option>
                      <option>Jalisco</option>
                      <option>México</option>
                      <option>Michoacán</option>
                      <option>Morelos</option>
                      <option>Nayarit</option>
                      <option>Nuevo León</option>
                      <option>Oaxaca</option>
                      <option>Puebla</option>
                      <option>Querétaro</option>
                      <option>Quintana Roo</option>
                      <option>San Luis Potosí</option>
                      <option>Sinaloa</option>
                      <option>Sonora</option>
                      <option>Tabasco</option>
                      <option>Tamaulipas</option>
                      <option>Tlaxcala</option>
                      <option>Veracruz</option>
                      <option>Yucatán</option>
                      <option>Zacatecas</option>
                    </select>
                  </div>
                  <input type="text" id="a-cp" name="a_cp" class="form-input" placeholder="Código Postal" required>
                </div>
                <p class="form-hint warn mt-3">⚠ Se recomienda anexar a la carta de invitación un comprobante de domicilio del anfitirión con antigüedad no mayor a 3 meses.</p>
                <p class="form-error" id="err-a-domicilio">Por favor completa el domicilio.</p>
              </div>

              <div>
                <label class="form-label" for="a-telefono">Teléfono de contacto <span class="req">*</span></label>
                <input type="tel" id="a-telefono" name="a_telefono" class="form-input"
                       placeholder="+52 55 1234 5678" required autocomplete="tel">
                <p class="form-hint warn">⚠ Migración puede llamar a este número exactamente al momento del arribo del visitante. Es fundamental que esté disponible durante las fechas del viaje.</p>
                <p class="form-error" id="err-a-telefono">Por favor ingresa un teléfono de contacto.</p>
              </div>

              <div>
                <label class="form-label" for="a-vinculo">Vínculo con el viajero <span class="req">*</span></label>
                <select id="a-vinculo" name="a_vinculo" class="form-input" required>
                  <option value="" disabled selected>¿Cuál es tu relación?</option>
                  <option value="familiar">Familiar</option>
                  <option value="pareja">Pareja</option>
                  <option value="amistad">Amistad</option>
                  <option value="laboral">Laboral</option>
                  <option value="otro">Otro</option>
                </select>
                <p class="form-error" id="err-a-vinculo">Por favor indica el vínculo.</p>
              </div>

            </div>

            <div class="flex items-center justify-between mt-8 gap-3">
              <button type="button" class="btn-back" onclick="goPrev(2)">
                <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                  <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Volver
              </button>
              <button type="button" class="btn-gold" onclick="goNext(2)">
                Continuar
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </section>


          <!-- ═══════════════════════════
               STEP 3 — EL VIAJE
          ═══════════════════════════ -->
          <section id="step-3" class="form-step p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <path d="M11 3C7.13 3 4 6.13 4 10c0 5.25 7 11 7 11s7-5.75 7-11c0-3.87-3.13-7-7-7z" stroke="#C9A84C" stroke-width="1.5"/>
                  <circle cx="11" cy="10" r="2.5" stroke="#C9A84C" stroke-width="1.4"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 3 de 5</span>
                <h2 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">El viaje</h2>
                <p class="text-sm mt-1" style="color:#6B7280;">Información sobre la estancia y el alojamiento en México.</p>
              </div>
            </div>

            <div class="space-y-5">

              <div>
                <label class="form-label" for="j-actividades">Actividades que realizará en México <span class="req">*</span></label>
                <textarea id="j-actividades" name="j_actividades" class="form-input"
                          placeholder="Ej. Turismo en Ciudad de México, visita a familiares en Guadalajara, recorridos culturales en Oaxaca…"
                          required rows="3"></textarea>
                <p class="form-hint">Descripción breve de las actividades turísticas o personales planeadas.</p>
                <p class="form-error" id="err-j-actividades">Por favor describe las actividades planeadas.</p>
              </div>

              <div>
                <label class="form-label" for="j-aloj-nombre">
                  Nombre del alojamiento
                  <span style="color:#9BAFD9;font-weight:400;">(si aplica, llenar solo en caso de ser hotel)</span>
                </label>
                <input type="text" id="j-aloj-nombre" name="j_aloj_nombre" class="form-input"
                       placeholder="Hotel, Airbnb, casa particular…">
                <p class="form-hint">Se recomienda tener la reservación a la mano para mostrar a la autoridad migratoria.</p>
              </div>

              <div>
                <label class="form-label">Dirección del alojamiento en México <span class="req">*</span></label>
                <div class="space-y-3">
                  <input type="text" id="j-al-calle" name="j_al_calle" class="form-input" placeholder="Calle y número" required>
                  <input type="text" id="j-al-colonia" name="j_al_colonia" class="form-input" placeholder="Colonia" required>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="j-al-ciudad" name="j_al_ciudad" class="form-input" placeholder="Ciudad o Alcaldía" required>
                    <input type="text" id="j-al-estado" name="j_al_estado" class="form-input" placeholder="Estado" required>
                  </div>
                  <input type="text" id="j-al-cp" name="j_al_cp" class="form-input" placeholder="Código Postal" required>
                </div>
                <p class="form-error" id="err-j-alojamiento">Por favor completa la dirección del alojamiento.</p>
              </div>

              <div>
                <label class="form-label" for="j-duracion">Duración total de la estancia <span class="req">*</span></label>
                <div class="flex items-center gap-3">
                  <input type="number" id="j-duracion" name="j_duracion" class="form-input"
                         style="max-width:130px;" min="1" max="180" placeholder="14" required>
                  <span class="text-sm" style="color:#6B7280;">días en México</span>
                </div>
                <p class="form-error" id="err-j-duracion">Por favor indica la duración de la estancia.</p>
              </div>

            </div>

            <div class="flex items-center justify-between mt-8 gap-3">
              <button type="button" class="btn-back" onclick="goPrev(3)">
                <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                  <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Volver
              </button>
              <button type="button" class="btn-gold" onclick="goNext(3)">
                Continuar
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </section>


          <!-- ═══════════════════════════
               STEP 4 — GASTOS
          ═══════════════════════════ -->
          <section id="step-4" class="form-step p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <rect x="3" y="7" width="16" height="11" rx="2" stroke="#C9A84C" stroke-width="1.5"/>
                  <path d="M7 7V5a4 4 0 018 0v2" stroke="#C9A84C" stroke-width="1.5"/>
                  <circle cx="11" cy="12.5" r="2" stroke="#C9A84C" stroke-width="1.4"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 4 de 5</span>
                <h2 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">Gastos del viaje</h2>
                <p class="text-sm mt-1" style="color:#6B7280;">¿Quién cubrirá los gastos durante la estancia en México?</p>
              </div>
            </div>

            <!-- Info note -->
            <div class="rounded-xl p-4 mb-6 text-sm" style="background:rgba(201,168,76,0.09);border:1px solid rgba(201,168,76,0.25);color:#7B5A24;line-height:1.65;">
              <strong>💡 Nota:</strong> Si el visitante cubre total o parcialmente sus propios gastos, se recomienda que pueda comprobar el equivalente de al menos <strong>USD $50 por día</strong> con efectivo, estado de cuenta bancario o de tarjeta.
            </div>

            <!-- Expense table -->
            <div class="rounded-xl overflow-hidden mb-7" style="border:1.5px solid rgba(27,53,102,0.1);">
              <div class="px-4 py-3 flex items-center justify-between"
                   style="background:rgba(27,53,102,0.04);border-bottom:1px solid rgba(27,53,102,0.08);">
                <span class="text-xs font-bold uppercase tracking-wider" style="color:var(--c-mid);">Concepto</span>
                <span class="text-xs font-bold uppercase tracking-wider" style="color:var(--c-mid);">¿Quién cubre?</span>
              </div>
              <div class="px-4 bg-white">

                <div class="expense-row">
                  <span class="expense-concept">🏨 Hospedaje</span>
                  <div class="expense-options">
                    <label class="exp-radio"><input type="radio" name="g_hospedaje" value="visitante">Visitante</label>
                    <label class="exp-radio"><input type="radio" name="g_hospedaje" value="anfitrion">Anfitrión</label>
                    <label class="exp-radio"><input type="radio" name="g_hospedaje" value="ambos">Ambos</label>
                  </div>
                </div>

                <div class="expense-row">
                  <span class="expense-concept">🍽️ Alimentos</span>
                  <div class="expense-options">
                    <label class="exp-radio"><input type="radio" name="g_alimentos" value="visitante">Visitante</label>
                    <label class="exp-radio"><input type="radio" name="g_alimentos" value="anfitrion">Anfitrión</label>
                    <label class="exp-radio"><input type="radio" name="g_alimentos" value="ambos">Ambos</label>
                  </div>
                </div>

                <div class="expense-row">
                  <span class="expense-concept">🚌 Transporte</span>
                  <div class="expense-options">
                    <label class="exp-radio"><input type="radio" name="g_transporte" value="visitante">Visitante</label>
                    <label class="exp-radio"><input type="radio" name="g_transporte" value="anfitrion">Anfitrión</label>
                    <label class="exp-radio"><input type="radio" name="g_transporte" value="ambos">Ambos</label>
                  </div>
                </div>

                <div class="expense-row">
                  <span class="expense-concept">🗺️ Actividades turísticas</span>
                  <div class="expense-options">
                    <label class="exp-radio"><input type="radio" name="g_actividades" value="visitante">Visitante</label>
                    <label class="exp-radio"><input type="radio" name="g_actividades" value="anfitrion">Anfitrión</label>
                    <label class="exp-radio"><input type="radio" name="g_actividades" value="ambos">Ambos</label>
                  </div>
                </div>

                <div class="expense-row">
                  <span class="expense-concept">🏥 Gastos médicos / emergencias</span>
                  <div class="expense-options">
                    <label class="exp-radio"><input type="radio" name="g_medicos" value="visitante">Visitante</label>
                    <label class="exp-radio"><input type="radio" name="g_medicos" value="anfitrion">Anfitrión</label>
                    <label class="exp-radio"><input type="radio" name="g_medicos" value="ambos">Ambos</label>
                  </div>
                </div>

              </div>
            </div>
            <p class="form-error" id="err-gastos">Por favor selecciona quién cubre cada concepto.</p>

            <!-- Transport modes -->
            <div>
              <label class="form-label">Medios de transporte del visitante en México <span class="req">*</span></label>
              <p class="text-xs mb-3" style="color:#6B7280;">Selecciona todos los que apliquen.</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5">
                <label class="radio-card" id="tc-avion">
                  <input type="checkbox" name="transporte_mx" value="avion" onchange="toggleTransportCard(this)">
                  <span>✈️ Avión interno</span>
                </label>
                <label class="radio-card" id="tc-autobus">
                  <input type="checkbox" name="transporte_mx" value="autobus" onchange="toggleTransportCard(this)">
                  <span>🚌 Autobús</span>
                </label>
                <label class="radio-card" id="tc-auto">
                  <input type="checkbox" name="transporte_mx" value="auto_rentado" onchange="toggleTransportCard(this)">
                  <span>🚗 Auto rentado</span>
                </label>
                <label class="radio-card" id="tc-anfitrion">
                  <input type="checkbox" name="transporte_mx" value="anfitrion" onchange="toggleTransportCard(this)">
                  <span>🏠 Transporte del anfitrión</span>
                </label>
                <label class="radio-card" id="tc-otro">
                  <input type="checkbox" name="transporte_mx" value="otro" onchange="toggleTransportCard(this)">
                  <span>🔹 Otro</span>
                </label>
              </div>
              <p class="form-error" id="err-transporte">Por favor selecciona al menos un medio de transporte.</p>
            </div>

            <div class="flex items-center justify-between mt-8 gap-3">
              <button type="button" class="btn-back" onclick="goPrev(4)">
                <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                  <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Volver
              </button>
              <button type="button" class="btn-gold" onclick="goNext(4)">
                Continuar
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </section>


          <!-- ═══════════════════════════
               STEP 5 — VUELOS
          ═══════════════════════════ -->
          <section id="step-5" class="form-step p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <path d="M2.5 14.5L5 13.5l11.5-8.5a2.5 2.5 0 013.5 3.5L11 20.5 8.5 18l.5-2.5-6.5 2z" stroke="#C9A84C" stroke-width="1.5" stroke-linejoin="round"/>
                  <path d="M3 19.5h16" stroke="#C9A84C" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 5 de 5</span>
                <h2 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">Vuelos e ingreso</h2>
                <p class="text-sm mt-1" style="color:#6B7280;">Cómo llegará y saldrá el viajero de México.</p>
              </div>
            </div>

            <!-- Important note -->
            <div class="rounded-xl p-4 mb-7 text-sm" style="background:rgba(201,168,76,0.09);border:1px solid rgba(201,168,76,0.25);color:#7B5A24;line-height:1.65;">
              <strong>⚠ Importante:</strong> Se debe comprobar que se cuenta con reservación para el viaje de regreso al momento del ingreso a México.
            </div>

            <!-- ── Ingreso ── -->
            <div class="mb-8">
              <p class="section-label mb-4">Ingreso a México</p>

              <div class="space-y-5">

                <div>
                  <label class="form-label">¿Cómo será el ingreso a México? <span class="req">*</span></label>
                  <div class="grid grid-cols-3 gap-3">
                    <label class="transport-type-card" id="ing-aereo-card">
                      <input type="radio" name="ingreso_tipo" value="aereo" onchange="onTransportType('ingreso', 'aereo')">
                      <span class="tt-icon">✈️</span>
                      <span class="tt-text">Aéreo</span>
                    </label>
                    <label class="transport-type-card" id="ing-terrestre-card">
                      <input type="radio" name="ingreso_tipo" value="terrestre" onchange="onTransportType('ingreso', 'terrestre')">
                      <span class="tt-icon">🚌</span>
                      <span class="tt-text">Terrestre</span>
                    </label>
                    <label class="transport-type-card" id="ing-maritimo-card">
                      <input type="radio" name="ingreso_tipo" value="maritimo" onchange="onTransportType('ingreso', 'maritimo')">
                      <span class="tt-icon">🚢</span>
                      <span class="tt-text">Marítimo</span>
                    </label>
                  </div>
                  <p class="form-error" id="err-ingreso-tipo">Por favor selecciona el tipo de ingreso.</p>
                </div>

                <!-- Condicional aéreo ingreso -->
                <div id="cond-ingreso-aereo" class="cond-fields space-y-4">
                  <div>
                    <label class="form-label" for="ing-aeropuerto">Aeropuerto de ingreso</label>
                    <input type="text" id="ing-aeropuerto" name="ing_aeropuerto" class="form-input"
                           placeholder="Ej. AICM — Ciudad de México">
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label class="form-label" for="ing-aerolinea">Aerolínea de llegada</label>
                      <input type="text" id="ing-aerolinea" name="ing_aerolinea" class="form-input" placeholder="Ej. Avianca, LATAM…">
                    </div>
                    <div>
                      <label class="form-label" for="ing-vuelo">Número de vuelo</label>
                      <input type="text" id="ing-vuelo" name="ing_vuelo" class="form-input" placeholder="Ej. AV204">
                    </div>
                  </div>
                </div>

                <!-- Condicional terrestre ingreso -->
                <div id="cond-ingreso-terrestre" class="cond-fields">
                  <label class="form-label" for="ing-cruce">Estado / punto de cruce fronterizo</label>
                  <input type="text" id="ing-cruce" name="ing_cruce" class="form-input" placeholder="Ej. Tijuana, Ciudad Juárez…">
                </div>

                <!-- Condicional marítimo ingreso -->
                <div id="cond-ingreso-maritimo" class="cond-fields">
                  <label class="form-label" for="ing-puerto">Puerto de ingreso</label>
                  <input type="text" id="ing-puerto" name="ing_puerto" class="form-input" placeholder="Ej. Puerto de Veracruz">
                </div>

                <div>
                  <label class="form-label" for="ing-fecha">Fecha de llegada a México <span class="req">*</span></label>
                  <input type="date" id="ing-fecha" name="ing_fecha" class="form-input" required>
                  <p class="form-error" id="err-ing-fecha">Por favor indica la fecha de llegada.</p>
                </div>

              </div>
            </div>

            <div class="gold-rule mb-7"></div>

            <!-- ── Salida ── -->
            <div>
              <p class="section-label mb-4">Salida de México</p>

              <div class="space-y-5">

                <div>
                  <label class="form-label">¿Cómo será la salida de México? <span class="req">*</span></label>
                  <div class="grid grid-cols-3 gap-3">
                    <label class="transport-type-card" id="sal-aereo-card">
                      <input type="radio" name="salida_tipo" value="aereo" onchange="onTransportType('salida', 'aereo')">
                      <span class="tt-icon">✈️</span>
                      <span class="tt-text">Aéreo</span>
                    </label>
                    <label class="transport-type-card" id="sal-terrestre-card">
                      <input type="radio" name="salida_tipo" value="terrestre" onchange="onTransportType('salida', 'terrestre')">
                      <span class="tt-icon">🚌</span>
                      <span class="tt-text">Terrestre</span>
                    </label>
                    <label class="transport-type-card" id="sal-maritimo-card">
                      <input type="radio" name="salida_tipo" value="maritimo" onchange="onTransportType('salida', 'maritimo')">
                      <span class="tt-icon">🚢</span>
                      <span class="tt-text">Marítimo</span>
                    </label>
                  </div>
                  <p class="form-error" id="err-salida-tipo">Por favor selecciona el tipo de salida.</p>
                </div>

                <!-- Condicional aéreo salida -->
                <div id="cond-salida-aereo" class="cond-fields space-y-4">
                  <div>
                    <label class="form-label" for="sal-aeropuerto">Aeropuerto de salida</label>
                    <input type="text" id="sal-aeropuerto" name="sal_aeropuerto" class="form-input"
                           placeholder="Ej. AICM — Ciudad de México">
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label class="form-label" for="sal-aerolinea">Aerolínea de regreso</label>
                      <input type="text" id="sal-aerolinea" name="sal_aerolinea" class="form-input" placeholder="Ej. Avianca, LATAM…">
                    </div>
                    <div>
                      <label class="form-label" for="sal-vuelo">Número de vuelo</label>
                      <input type="text" id="sal-vuelo" name="sal_vuelo" class="form-input" placeholder="Ej. AV205">
                    </div>
                  </div>
                </div>

                <!-- Condicional terrestre salida -->
                <div id="cond-salida-terrestre" class="cond-fields">
                  <label class="form-label" for="sal-cruce">Estado / punto de cruce fronterizo</label>
                  <input type="text" id="sal-cruce" name="sal_cruce" class="form-input" placeholder="Ej. Nuevo Laredo, Reynosa…">
                </div>

                <!-- Condicional marítimo salida -->
                <div id="cond-salida-maritimo" class="cond-fields">
                  <label class="form-label" for="sal-puerto">Puerto de salida</label>
                  <input type="text" id="sal-puerto" name="sal_puerto" class="form-input" placeholder="Ej. Puerto de Ensenada">
                </div>

                <div>
                  <label class="form-label" for="sal-fecha">Fecha de regreso <span class="req">*</span></label>
                  <input type="date" id="sal-fecha" name="sal_fecha" class="form-input" required>
                  <p class="form-error" id="err-sal-fecha">Por favor indica la fecha de regreso.</p>
                </div>

              </div>
            </div>

            <div class="flex items-center justify-between mt-8 gap-3">
              <button type="button" class="btn-back" onclick="goPrev(5)">
                <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                  <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Volver
              </button>
              <button type="button" class="btn-gold" onclick="goNext(5)" style="white-space:nowrap;font-size:0.9375rem;">
                Revisar información
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>

          </section>

          <!-- ═══════════════════════
               STEP 6 — REVISIÓN
          ═══════════════════════ -->
          <section id="step-6" class="form-step p-6 sm:p-8">

            <div class="flex items-start gap-4 mb-7">
              <div class="step-icon">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" aria-hidden="true">
                  <path d="M4 6h14M4 11h10M4 16h7" stroke="#C9A84C" stroke-width="1.5" stroke-linecap="round"/>
                  <circle cx="17" cy="16" r="3" stroke="#C9A84C" stroke-width="1.4"/>
                  <path d="M19 18l2 2" stroke="#C9A84C" stroke-width="1.4" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <span class="section-label mb-1">Paso 6 de 6</span>
                <h2 style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.625rem;font-weight:600;color:var(--c-navy);line-height:1.2;margin:0;">Revisa tu información</h2>
                <p class="text-sm mt-1" style="color:#6B7280;">Verifica que todos los datos sean correctos antes de proceder al pago.</p>
              </div>
            </div>

            <!-- CTA box — visible immediately on arrival at step 6 -->
            <div class="rounded-2xl p-5 mb-6" style="background:var(--c-cream);border:1px solid rgba(27,53,102,0.08);">
              <p class="text-sm font-semibold mb-1" style="color:var(--c-navy);">¿Todo correcto?</p>
              <p class="text-xs mb-4" style="color:#6B7280;line-height:1.6;">Revisa tus datos abajo y confirma para proceder al pago seguro. Tu carta PDF llegará a tu correo en minutos.</p>
              <div class="flex items-center gap-2 text-xs mb-5" style="color:#6B7280;">
                <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
                  <rect x="1.5" y="5.5" width="10" height="7" rx="1.5" stroke="#C9A84C" stroke-width="1.1"/>
                  <path d="M4 5.5V4a2.5 2.5 0 015 0v1.5" stroke="#C9A84C" stroke-width="1.1"/>
                </svg>
                Pago procesado por <strong>Stripe</strong>. No almacenamos datos de tarjeta.
              </div>
              <div class="flex items-center justify-between gap-3">
                <button type="button" class="btn-back" onclick="goPrev(6)">
                  <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                    <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Volver y editar
                </button>
                <button type="button" class="btn-navy" onclick="goNext(6)" style="white-space:nowrap;font-size:0.9375rem;">
                  Confirmar y pagar · $5 USD
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Review data cards — populated by buildReview() -->
            <p class="text-xs font-semibold mb-3" style="color:#6B7280;text-transform:uppercase;letter-spacing:0.06em;">Tu información</p>
            <div id="review-content" class="space-y-4">
              <!-- Populated by buildReview() -->
            </div>

            <!-- CTA box — repeated at the bottom after review cards -->
            <div class="rounded-2xl p-5 mt-6" style="background:var(--c-cream);border:1px solid rgba(27,53,102,0.08);">
              <p class="text-sm font-semibold mb-1" style="color:var(--c-navy);">¿Todo correcto?</p>
              <p class="text-xs mb-4" style="color:#6B7280;line-height:1.6;">Revisa tus datos abajo y confirma para proceder al pago seguro. Tu carta PDF llegará a tu correo en minutos.</p>
              <div class="flex items-center gap-2 text-xs mb-5" style="color:#6B7280;">
                <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
                  <rect x="1.5" y="5.5" width="10" height="7" rx="1.5" stroke="#C9A84C" stroke-width="1.1"/>
                  <path d="M4 5.5V4a2.5 2.5 0 015 0v1.5" stroke="#C9A84C" stroke-width="1.1"/>
                </svg>
                Pago procesado por <strong>Stripe</strong>. No almacenamos datos de tarjeta.
              </div>
              <div class="flex items-center justify-between gap-3">
                <button type="button" class="btn-back" onclick="goPrev(6)">
                  <svg width="15" height="15" viewBox="0 0 15 15" fill="none" aria-hidden="true">
                    <path d="M12 7.5H3M6.5 4L3 7.5 6.5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Volver y editar
                </button>
                <button type="button" class="btn-navy" onclick="goNext(6)" style="white-space:nowrap;font-size:0.9375rem;">
                  Confirmar y pagar · $5 USD
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M3 8h10M9.5 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>

          </section>

        </form>
      </div><!-- /form card -->

      <!-- Bottom trust strip -->
      <div class="flex flex-wrap items-center justify-center gap-5 mt-6 text-xs" style="color:#9BAFD9;">
        <span class="flex items-center gap-1.5">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true">
            <rect x="1" y="4.5" width="10" height="7" rx="1.5" stroke="#C9A84C" stroke-width="1.1"/>
            <path d="M3.5 4.5V3.5a2.5 2.5 0 015 0v1" stroke="#C9A84C" stroke-width="1.1"/>
          </svg>
          Conexión segura HTTPS
        </span>
<a href="/privacidad" style="color:#9BAFD9;" class="hover:underline">Privacidad</a>
        <a href="/terminos" style="color:#9BAFD9;" class="hover:underline">Términos</a>
      </div>

    </div><!-- /form panel -->

  </div><!-- /two-col grid -->

</div><!-- /max-w -->

</main>


<script>
  const TOTAL = 6;
  const LABELS = [
    'Paso 1 de 6 — El viajero',
    'Paso 2 de 6 — El anfitrión',
    'Paso 3 de 6 — El viaje',
    'Paso 4 de 6 — Gastos',
    'Paso 5 de 6 — Vuelos',
    'Paso 6 de 6 — Revisión',
  ];
  let current = 1;

  /* ── Expense radio visual state ── */
  document.querySelectorAll('.exp-radio input[type="radio"]').forEach(input => {
    input.addEventListener('change', function() {
      const siblings = document.querySelectorAll(`input[name="${this.name}"]`);
      siblings.forEach(r => r.closest('.exp-radio').classList.remove('selected-exp'));
      if (this.checked) this.closest('.exp-radio').classList.add('selected-exp');
    });
  });

  /* ── Checkbox radio-card toggle ── */
  function toggleTransportCard(input) {
    const card = input.closest('.radio-card');
    card.classList.toggle('selected', input.checked);
    if (document.querySelectorAll('input[name="transporte_mx"]:checked').length > 0) {
      document.getElementById('err-transporte')?.classList.remove('show');
    }
  }

  /* ── Conditional transport type fields ── */
  function onTransportType(prefix, value) {
    ['aereo','terrestre','maritimo'].forEach(type => {
      const el = document.getElementById(`cond-${prefix}-${type}`);
      const card = document.getElementById(`${prefix === 'ingreso' ? 'ing' : 'sal'}-${type}-card`);
      if (el) el.classList.remove('open');
      if (card) card.classList.remove('selected');
    });

    const selected = document.getElementById(`cond-${prefix}-${value}`);
    const selectedCard = document.getElementById(`${prefix === 'ingreso' ? 'ing' : 'sal'}-${value}-card`);
    if (selected) selected.classList.add('open');
    if (selectedCard) selectedCard.classList.add('selected');
    const errId = prefix === 'ingreso' ? 'err-ingreso-tipo' : 'err-salida-tipo';
    document.getElementById(errId)?.classList.remove('show');
  }

  /* ── Sidebar state ── */
  function updateSidebar(n) {
    for (let i = 1; i <= TOTAL; i++) {
      const dot  = document.getElementById('dot-' + i);
      const lbl  = document.getElementById('pl-' + i);
      if (!dot) continue;
      const pill = dot.closest('.step-pill');
      dot.className = 'pill-dot';
      lbl.className = 'pill-label';
      if (i < n) {
        dot.classList.add('done');
        dot.innerHTML = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2.5 6l3 3 4-4.5" stroke="#C9A84C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        lbl.classList.add('done-txt');
        if (pill) { pill.classList.add('pill-nav'); pill.onclick = (function(step){ return function(){ current = step; showStep(step); }; })(i); }
      } else if (i === n) {
        dot.classList.add('active');
        dot.textContent = i;
        lbl.classList.add('active-txt');
        if (pill) { pill.classList.remove('pill-nav'); pill.onclick = null; }
      } else {
        dot.classList.add('pending');
        dot.textContent = i;
        lbl.classList.add('pending-txt');
        if (pill) { pill.classList.remove('pill-nav'); pill.onclick = null; }
      }
    }
  }

  /* ── Show step ── */
  function showStep(n) {
    document.querySelectorAll('.form-step').forEach(el => {
      el.classList.remove('active');
      el.style.display = 'none';
    });
    const step = document.getElementById('step-' + n);
    step.style.display = 'block';
    step.classList.add('active');
    updateSidebar(n);
    document.getElementById('mob-label').textContent = LABELS[n - 1];
    document.getElementById('mob-fill').style.width = (n / TOTAL * 100) + '%';
    window.scrollTo({ top: 0, behavior: 'smooth' });
    if (n === TOTAL) buildReview();
  }

  /* ── Validation helpers ── */
  function req(id, errId) {
    const el = document.getElementById(id);
    if (!el) return true;
    const ok = el.value.trim().length > 0;
    el.classList.toggle('error', !ok);
    if (errId) document.getElementById(errId)?.classList.toggle('show', !ok);
    return ok;
  }
  function selReq(id, errId) {
    const el = document.getElementById(id);
    if (!el) return true;
    const ok = el.value !== '';
    el.classList.toggle('error', !ok);
    if (errId) document.getElementById(errId)?.classList.toggle('show', !ok);
    return ok;
  }
  function emailReq(id, errId) {
    const el = document.getElementById(id);
    if (!el) return true;
    const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value.trim());
    el.classList.toggle('error', !ok);
    if (errId) document.getElementById(errId)?.classList.toggle('show', !ok);
    return ok;
  }

  /* ── Clear step errors ── */
  function clearErrors(stepEl) {
    stepEl.querySelectorAll('.form-error.show').forEach(e => e.classList.remove('show'));
    stepEl.querySelectorAll('.form-input.error').forEach(e => e.classList.remove('error'));
    stepEl.querySelectorAll('.expense-row.error').forEach(e => e.classList.remove('error'));
  }

  /* ── Validate step ── */
  function validateStep(n) {
    const stepEl = document.getElementById('step-' + n);
    clearErrors(stepEl);
    let ok = true;

    if (n === 1) {
      ok &= req('v-nombre',     'err-v-nombre');
      ok &= req('v-nacimiento', 'err-v-nacimiento');
      ok &= selReq('v-nacionalidad', 'err-v-nacionalidad');
      ok &= req('v-pasaporte',  'err-v-pasaporte');
      ok &= selReq('v-residencia', 'err-v-residencia');
      ok &= req('v-calle',      'err-v-domicilio');
      ok &= req('v-ciudad',     'err-v-domicilio');
      ok &= req('v-provincia',  'err-v-domicilio');
      ok &= req('v-cp',         'err-v-domicilio');
      ok &= req('v-ocupacion',  'err-v-ocupacion');
      ok &= emailReq('v-email', 'err-v-email');
    } else if (n === 2) {
      ok &= req('a-nombre',     'err-a-nombre');
      ok &= req('a-nacimiento', 'err-a-nacimiento');
      ok &= selReq('a-id-tipo', 'err-a-id-tipo');
      ok &= req('a-id-num',     'err-a-id-num');
      ok &= req('a-calle',        'err-a-domicilio');
      ok &= req('a-colonia',      'err-a-domicilio');
      ok &= req('a-delegacion',   'err-a-domicilio');
      ok &= req('a-ciudad',       'err-a-domicilio');
      ok &= selReq('a-estado',    'err-a-domicilio');
      ok &= req('a-cp',           'err-a-domicilio');
      ok &= req('a-telefono',     'err-a-telefono');
      ok &= selReq('a-vinculo',   'err-a-vinculo');
    } else if (n === 3) {
      ok &= req('j-actividades', 'err-j-actividades');
      ok &= req('j-al-calle',    'err-j-alojamiento');
      ok &= req('j-al-colonia',  'err-j-alojamiento');
      ok &= req('j-al-ciudad',   'err-j-alojamiento');
      ok &= req('j-al-estado',   'err-j-alojamiento');
      ok &= req('j-al-cp',       'err-j-alojamiento');
      ok &= req('j-duracion',    'err-j-duracion');
    } else if (n === 4) {
      const expenseGroups = ['g_hospedaje','g_alimentos','g_transporte','g_actividades','g_medicos'];
      const expenseRows   = stepEl.querySelectorAll('.expense-row');
      let expOk = true;
      expenseGroups.forEach((name, i) => {
        if (!document.querySelector(`input[name="${name}"]:checked`)) {
          if (expenseRows[i]) expenseRows[i].classList.add('error');
          expOk = false;
        }
      });
      if (!expOk) {
        document.getElementById('err-gastos').classList.add('show');
        ok = false;
      }
      const checked = document.querySelectorAll('input[name="transporte_mx"]:checked');
      if (checked.length === 0) {
        document.getElementById('err-transporte').classList.add('show');
        ok = false;
      }
    } else if (n === 5) {
      const ingreso = document.querySelector('input[name="ingreso_tipo"]:checked');
      const salida  = document.querySelector('input[name="salida_tipo"]:checked');
      if (!ingreso) { document.getElementById('err-ingreso-tipo').classList.add('show'); ok = false; }
      else {
        if (ingreso.value === 'aereo') {
          ['ing-aeropuerto','ing-aerolinea','ing-vuelo'].forEach(id => {
            const el = document.getElementById(id);
            if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
          });
        } else if (ingreso.value === 'terrestre') {
          const el = document.getElementById('ing-cruce');
          if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
        } else if (ingreso.value === 'maritimo') {
          const el = document.getElementById('ing-puerto');
          if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
        }
      }
      if (!salida)  { document.getElementById('err-salida-tipo').classList.add('show'); ok = false; }
      else {
        if (salida.value === 'aereo') {
          ['sal-aeropuerto','sal-aerolinea','sal-vuelo'].forEach(id => {
            const el = document.getElementById(id);
            if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
          });
        } else if (salida.value === 'terrestre') {
          const el = document.getElementById('sal-cruce');
          if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
        } else if (salida.value === 'maritimo') {
          const el = document.getElementById('sal-puerto');
          if (el && !el.value.trim()) { el.classList.add('error'); ok = false; }
        }
      }
      ok &= req('ing-fecha', 'err-ing-fecha');
      ok &= req('sal-fecha', 'err-sal-fecha');
    }

    return Boolean(ok);
  }

  /* ── Collect all form fields into a JSON object ── */
  function collectFormData() {
    const data = {};
    // Text / select / textarea inputs
    document.querySelectorAll('#wizard input[type="text"], #wizard input[type="email"], #wizard input[type="date"], #wizard input[type="number"], #wizard input[type="tel"], #wizard select, #wizard textarea').forEach(el => {
      if (el.id) data[el.id] = el.value.trim();
    });
    // Radio inputs
    document.querySelectorAll('#wizard input[type="radio"]:checked').forEach(el => {
      data[el.name] = el.value;
    });
    // Checkbox inputs
    document.querySelectorAll('#wizard input[type="checkbox"]:checked').forEach(el => {
      if (!data[el.name]) data[el.name] = [];
      if (Array.isArray(data[el.name])) data[el.name].push(el.value);
      else data[el.name] = [data[el.name], el.value];
    });
    return data;
  }

  /* ── Submit to API and redirect to Stripe ── */
  async function submitToAPI() {
    const confirmBtn = document.querySelector('[onclick*="goNext"]') || document.querySelector('.btn-pay, .btn-next');
    if (confirmBtn) {
      confirmBtn.disabled = true;
      confirmBtn.innerHTML = '<span class="inline-flex items-center gap-2"><span class="spinner" style="width:18px;height:18px;border:2px solid rgba(27,53,102,0.2);border-top-color:var(--c-navy);border-radius:50%;animation:spin 0.7s linear infinite;"></span> Procesando…</span>';
    }

    try {
      const formData = collectFormData();
      const email = formData['v-email'] || '';

      const res = await fetch('/api/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          plan: 'esencial',
          email,
          formData,
        }),
      });

      const result = await res.json();

      if (!res.ok) {
        throw new Error(result.error || 'Error al procesar la solicitud.');
      }

      // Redirigir a Stripe Checkout
      window.location.href = result.url;

    } catch (err) {
      alert('Hubo un error al procesar tu solicitud. Por favor intenta de nuevo.\n\n' + err.message);
      if (confirmBtn) {
        confirmBtn.disabled = false;
        confirmBtn.innerHTML = 'Confirmar y pagar';
      }
    }
  }

  /* ── Navigation ── */
  function goNext(n) {
    if (!validateStep(n)) return;
    if (n < TOTAL) {
      if (n === 5) buildReview();
      current = n + 1;
      showStep(current);
    } else {
      submitToAPI();
    }
  }

  function goPrev(n) {
    if (n > 1) {
      current = n - 1;
      showStep(current);
    }
  }

  /* ── Build review screen ── */
  function rval(id) {
    const el = document.getElementById(id);
    return el ? (el.value.trim() || '—') : '—';
  }
  function reviewCard(title, rows) {
    const items = rows.map(([label, value]) =>
      `<div><dt style="font-size:0.75rem;color:#6B7280;font-weight:500;margin-bottom:2px;">${label}</dt>` +
      `<dd style="font-size:0.875rem;color:var(--c-navy);font-weight:600;margin:0;">${value || '—'}</dd></div>`
    ).join('');
    return `<div style="background:var(--c-cream);border:1px solid rgba(27,53,102,0.08);border-radius:16px;padding:20px;">` +
      `<p style="font-size:0.6875rem;font-weight:700;letter-spacing:0.13em;text-transform:uppercase;color:var(--c-gold);margin:0 0 8px;">${title}</p>` +
      `<div class="gold-rule" style="margin-bottom:14px;"></div>` +
      `<dl style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px 16px;margin:0;">${items}</dl></div>`;
  }
  function buildReview() {
    // Viajero
    const addr = [rval('v-calle'), rval('v-ciudad'), rval('v-provincia'), rval('v-cp')].filter(v => v !== '—').join(', ');
    const viajero = reviewCard('El viajero', [
      ['Nombre completo', rval('v-nombre')],
      ['Fecha de nacimiento', rval('v-nacimiento')],
      ['Nacionalidad', rval('v-nacionalidad')],
      ['N.º de pasaporte', rval('v-pasaporte')],
      ['País de residencia', rval('v-residencia')],
      ['Domicilio', addr || '—'],
      ['Ocupación', rval('v-ocupacion')],
      ['Correo electrónico', rval('v-email')],
    ]);

    // Anfitrión
    const anfiAddr = [rval('a-calle'), rval('a-colonia'), rval('a-delegacion'), rval('a-ciudad'), rval('a-estado'), rval('a-cp')].filter(v => v !== '—').join(', ');
    const anfitrion = reviewCard('El anfitrión', [
      ['Nombre completo', rval('a-nombre')],
      ['Fecha de nacimiento', rval('a-nacimiento')],
      ['Tipo de ID', rval('a-id-tipo')],
      ['N.º de ID', rval('a-id-num')],
      ['Domicilio en México', anfiAddr || '—'],
      ['Teléfono', rval('a-telefono')],
      ['Vínculo con el viajero', rval('a-vinculo')],
    ]);

    // El viaje
    const alojAddr = [rval('j-al-calle'), rval('j-al-colonia'), rval('j-al-ciudad'), rval('j-al-estado'), rval('j-al-cp')].filter(v => v !== '—').join(', ');
    const viaje = reviewCard('El viaje', [
      ['Actividades', rval('j-actividades')],
      ['Nombre del alojamiento', rval('j-aloj-nombre') !== '—' ? rval('j-aloj-nombre') : document.getElementById('j-aloj-nombre')?.value || '—'],
      ['Dirección del alojamiento', alojAddr || '—'],
      ['Duración de estancia', rval('j-duracion') !== '—' ? rval('j-duracion') + ' días' : '—'],
    ]);

    // Gastos
    const getExp = name => { const r = document.querySelector(`input[name="${name}"]:checked`); return r ? r.value : '—'; };
    const modos = Array.from(document.querySelectorAll('input[name="transporte_mx"]:checked')).map(i => i.value).join(', ') || '—';
    const gastos = reviewCard('Gastos', [
      ['Hospedaje', getExp('g_hospedaje')],
      ['Alimentos', getExp('g_alimentos')],
      ['Transporte', getExp('g_transporte')],
      ['Actividades', getExp('g_actividades')],
      ['Atención médica', getExp('g_medicos')],
      ['Transporte en México', modos],
    ]);

    // Vuelos
    const ingresoTipo = document.querySelector('input[name="ingreso_tipo"]:checked')?.value || '';
    let ingresoDetail = '—';
    if (ingresoTipo === 'aereo') ingresoDetail = [rval('ing-aeropuerto'), rval('ing-aerolinea'), rval('ing-vuelo')].filter(v => v !== '—').join(' · ') || '—';
    else if (ingresoTipo === 'terrestre') ingresoDetail = rval('ing-cruce');
    else if (ingresoTipo === 'maritimo') ingresoDetail = rval('ing-puerto');
    const salidaTipo = document.querySelector('input[name="salida_tipo"]:checked')?.value || '';
    let salidaDetail = '—';
    if (salidaTipo === 'aereo') salidaDetail = [rval('sal-aeropuerto'), rval('sal-aerolinea'), rval('sal-vuelo')].filter(v => v !== '—').join(' · ') || '—';
    else if (salidaTipo === 'terrestre') salidaDetail = rval('sal-cruce');
    else if (salidaTipo === 'maritimo') salidaDetail = rval('sal-puerto');
    const vuelos = reviewCard('Vuelos', [
      ['Tipo de ingreso', ingresoTipo || '—'],
      ['Detalle ingreso', ingresoDetail],
      ['Fecha de llegada', rval('ing-fecha')],
      ['Tipo de salida', salidaTipo || '—'],
      ['Detalle salida', salidaDetail],
      ['Fecha de regreso', rval('sal-fecha')],
    ]);

    document.getElementById('review-content').innerHTML = viajero + anfitrion + viaje + gastos + vuelos;
  }

  /* ── Real-time field validation setup ── */
  function setupRealtimeValidation() {
    // Text / textarea → validate on blur
    [
      ['v-nombre','err-v-nombre'], ['v-pasaporte','err-v-pasaporte'],
      ['v-residencia','err-v-residencia'], ['v-calle','err-v-domicilio'],
      ['v-ciudad','err-v-domicilio'], ['v-provincia','err-v-domicilio'],
      ['v-ocupacion','err-v-ocupacion'], ['a-nombre','err-a-nombre'],
      ['a-id-num','err-a-id-num'], ['a-calle','err-a-domicilio'],
      ['a-ciudad','err-a-domicilio'], ['a-telefono','err-a-telefono'],
      ['j-actividades','err-j-actividades'], ['j-al-calle','err-j-alojamiento'],
      ['j-al-ciudad','err-j-alojamiento'], ['j-duracion','err-j-duracion'],
    ].forEach(([id, errId]) => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('blur', () => req(id, errId));
    });
    // Date inputs → validate on change
    [
      ['v-nacimiento','err-v-nacimiento'], ['a-nacimiento','err-a-nacimiento'],
      ['ing-fecha','err-ing-fecha'], ['sal-fecha','err-sal-fecha'],
    ].forEach(([id, errId]) => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('change', () => req(id, errId));
    });
    // Select inputs → validate on change
    [
      ['v-nacionalidad','err-v-nacionalidad'],
      ['a-id-tipo','err-a-id-tipo'],
      ['a-vinculo','err-a-vinculo'],
    ].forEach(([id, errId]) => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('change', () => selReq(id, errId));
    });
  }

  /* ── Init ── */
  setupRealtimeValidation();
  showStep(1);
</script>

</body>
</html>
